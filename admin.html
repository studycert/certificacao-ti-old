<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyCert - Painel Administrativo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ========== VARIÁVEIS CSS & RESET ========== */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
            --gray-light: #f8f9fa;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ========== HEADER ADMIN ========== */
        .admin-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: white;
        }

        .logo i {
            font-size: 2rem;
            color: var(--secondary);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo span {
            color: var(--secondary);
        }

        .admin-nav {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-admin {
            background: var(--accent);
            color: white;
        }

        .btn {
            padding: 0.6rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn-outline:hover {
            background: white;
            color: var(--primary);
        }

        .btn-sm {
            padding: 0.4rem 1rem;
            font-size: 0.85rem;
        }

        /* Menu mobile toggle */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* ========== DASHBOARD ========== */
        .dashboard {
            padding: 2rem 0;
        }

        .welcome-section {
            margin-bottom: 2.5rem;
        }

        .welcome-section h1 {
            font-size: 2.2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .welcome-section p {
            color: var(--gray);
            font-size: 1.1rem;
        }

        /* Estatísticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.users { background: var(--secondary); }
        .stat-icon.files { background: var(--success); }
        .stat-icon.videos { background: var(--warning); }
        .stat-icon.materials { background: var(--danger); }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 0.25rem;
            color: var(--primary);
        }

        .stat-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Tabs do Admin */
        .admin-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-tab.active {
            background: var(--primary);
            color: white;
        }

        .admin-tab:hover:not(.active) {
            background: #f0f0f0;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .tab-content.active {
            display: block;
        }

        /* Tabelas */
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            margin-bottom: 2rem;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            background: var(--gray-light);
            border-bottom: 1px solid #ddd;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        th {
            background: var(--primary);
            color: white;
            font-weight: 600;
            text-align: left;
            padding: 1rem;
            white-space: nowrap;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Formulários */
        .form-container {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            max-width: 800px;
            margin: 0 auto;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--primary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed var(--gray);
            border-radius: var(--border-radius);
            padding: 3rem 2rem;
            text-align: center;
            background: var(--gray-light);
            margin: 2rem 0;
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-area:hover {
            border-color: var(--secondary);
            background: #f0f7ff;
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 1.5rem;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .modal-body {
            padding: 2rem;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: var(--success);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10000;
            animation: slideInRight 0.3s ease;
            display: none;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.error {
            background: var(--danger);
        }

        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active { background: var(--success); color: white; }
        .status-inactive { background: var(--gray); color: white; }
        .status-pending { background: var(--warning); color: white; }

        /* ========== RESPONSIVIDADE ========== */
        @media (max-width: 1024px) {
            .container {
                padding: 0 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            table {
                min-width: 600px;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-wrap: wrap;
            }

            .menu-toggle {
                display: block;
                order: 1;
            }

            .admin-nav {
                width: 100%;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
                order: 3;
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
                padding-top: 1rem;
            }

            .admin-nav.active {
                max-height: 300px;
            }

            .user-info {
                flex-direction: column;
                align-items: flex-start;
            }

            .user-info span:not(.badge) {
                display: none;
            }

            .welcome-section h1 {
                font-size: 1.8rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .admin-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .table-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stat-card {
                flex-direction: column;
                text-align: center;
            }

            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .table-actions {
                flex-direction: column;
            }

            .table-actions .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header Admin -->
    <header class="admin-header">
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    <h1>Study<span>Cert</span> Admin</h1>
                </a>
                
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="admin-nav" id="adminNav">
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">A</div>
                        <span id="userName">Administrador</span>
                        <span class="badge badge-admin">Admin</span>
                    </div>
                    <button class="btn btn-outline" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Dashboard -->
    <main class="dashboard">
        <div class="container">
            <!-- Welcome Section -->
            <div class="welcome-section">
                <h1>Painel Administrativo</h1>
                <p>Gerencie usuários, conteúdos e configurações do sistema</p>
            </div>

            <!-- Estatísticas -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon users">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalUsers">0</h3>
                        <p>Usuários Registrados</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon files">
                        <i class="fas fa-file"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalFiles">0</h3>
                        <p>Arquivos Uploadados</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon videos">
                        <i class="fas fa-video"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalVideos">0</h3>
                        <p>Videoaulas</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon materials">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalMaterials">0</h3>
                        <p>Materiais de Estudo</p>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="users">
                    <i class="fas fa-users"></i> Usuários
                </button>
                <button class="admin-tab" data-tab="files">
                    <i class="fas fa-file"></i> Arquivos
                </button>
                <button class="admin-tab" data-tab="videos">
                    <i class="fas fa-video"></i> Videos
                </button>
                <button class="admin-tab" data-tab="materials">
                    <i class="fas fa-book"></i> Materiais
                </button>
                <button class="admin-tab" data-tab="simulados">
                    <i class="fas fa-file-alt"></i> Simulados
                </button>
                <button class="admin-tab" data-tab="settings">
                    <i class="fas fa-cog"></i> Configurações
                </button>
            </div>

            <!-- Conteúdo das Tabs -->
            <div class="tab-content active" id="usersTab">
                <div class="table-container">
                    <div class="table-header">
                        <h3>Gerenciamento de Usuários</h3>
                        <button class="btn btn-success" id="addUserBtn">
                            <i class="fas fa-plus"></i> Novo Usuário
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Email</th>
                                    <th>Tipo</th>
                                    <th>Status</th>
                                    <th>Data Cadastro</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Usuários serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="filesTab">
                <div class="upload-area" id="fileUploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h3>Upload de Arquivos</h3>
                    <p>Arraste e solte arquivos aqui ou clique para selecionar</p>
                    <input type="file" id="fileInput" multiple style="display: none;">
                    <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                        <i class="fas fa-folder-open"></i> Selecionar Arquivos
                    </button>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3>Arquivos do Sistema</h3>
                        <div>
                            <button class="btn btn-outline" onclick="refreshFiles()">
                                <i class="fas fa-sync"></i> Atualizar
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Tipo</th>
                                    <th>Tamanho</th>
                                    <th>Data Upload</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="filesTableBody">
                                <!-- Arquivos serão carregados aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Outras tabs podem ser implementadas seguindo o mesmo padrão -->

            <div class="tab-content" id="settingsTab">
                <div class="form-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Configurações do Sistema</h3>
                    
                    <div class="form-group">
                        <label for="siteName">Nome do Site</label>
                        <input type="text" id="siteName" value="StudyCert" placeholder="Nome do site">
                    </div>
                    
                    <div class="form-group">
                        <label for="siteEmail">Email de Contato</label>
                        <input type="email" id="siteEmail" value="contato@studycert.com" placeholder="Email de contato">
                    </div>
                    
                    <div class="form-group">
                        <label for="maintenanceMode">Modo Manutenção</label>
                        <select id="maintenanceMode">
                            <option value="false">Desativado</option>
                            <option value="true">Ativado</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn btn-outline" onclick="resetSettings()">
                            <i class="fas fa-undo"></i> Resetar
                        </button>
                        <button class="btn btn-primary" onclick="saveSettings()">
                            <i class="fas fa-save"></i> Salvar Configurações
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Novo Usuário -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Novo Usuário</h3>
                <button class="btn btn-outline btn-sm" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="modalUserName">Nome Completo *</label>
                            <input type="text" id="modalUserName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="modalUserEmail">Email *</label>
                            <input type="email" id="modalUserEmail" required>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="modalUserPassword">Senha *</label>
                            <input type="password" id="modalUserPassword" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="modalUserType">Tipo de Usuário *</label>
                            <select id="modalUserType" required>
                                <option value="student">Estudante</option>
                                <option value="instructor">Instrutor</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="modalUserStatus">Status</label>
                        <select id="modalUserStatus">
                            <option value="active">Ativo</option>
                            <option value="inactive">Inativo</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar Usuário</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage"></span>
    </div>

    <script>
        // ========== BANCO DE DADOS ==========
        let db = {
            users: [],
            files: [],
            videos: [],
            materials: [],
            simulados: [],
            settings: {
                siteName: "StudyCert",
                siteEmail: "contato@studycert.com",
                maintenanceMode: false
            }
        };

        let editingUserId = null;
        let currentUser = null;

        // ========== INICIALIZAÇÃO ==========
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadDatabase();
            setupEventListeners();
            updateStats();
            loadUsersTable();
        });

        function checkAuth() {
            const savedUser = localStorage.getItem('currentUser');
            if (!savedUser) {
                window.location.href = 'index.html';
                return;
            }
            
            currentUser = JSON.parse(savedUser);
            if (currentUser.type !== 'admin') {
                window.location.href = 'index.html';
                return;
            }
            
            // Atualizar UI do usuário
            document.getElementById('userName').textContent = currentUser.name;
            const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
            document.getElementById('userAvatar').textContent = initials;
        }

        function loadDatabase() {
            // Carregar do localStorage ou usar dados padrão
            const savedDB = localStorage.getItem('adminDB');
            if (savedDB) {
                db = JSON.parse(savedDB);
            } else {
                // Dados iniciais
                db.users = [
                    {
                        id: 1,
                        name: 'Administrador',
                        email: 'admin@studycert.com',
                        password: 'admin123',
                        type: 'admin',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: 'João Silva',
                        email: 'joao@email.com',
                        password: 'senha123',
                        type: 'student',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        name: 'Maria Santos',
                        email: 'maria@email.com',
                        password: 'senha123',
                        type: 'instructor',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    }
                ];
                
                db.files = [
                    {
                        id: 1,
                        name: 'Guia LPIC-1.pdf',
                        type: 'PDF',
                        size: '2.5 MB',
                        uploadedAt: '2023-10-15',
                        uploadedBy: 'Admin'
                    },
                    {
                        id: 2,
                        name: 'Simulado ITIL 4.xlsx',
                        type: 'Excel',
                        size: '1.8 MB',
                        uploadedAt: '2023-10-10',
                        uploadedBy: 'Admin'
                    }
                ];
                
                saveDatabase();
            }
            
            // Carregar configurações na UI
            document.getElementById('siteName').value = db.settings.siteName;
            document.getElementById('siteEmail').value = db.settings.siteEmail;
            document.getElementById('maintenanceMode').value = db.settings.maintenanceMode.toString();
        }

        function saveDatabase() {
            localStorage.setItem('adminDB', JSON.stringify(db));
        }

        // ========== EVENT LISTENERS ==========
        function setupEventListeners() {
            // Menu mobile
            document.getElementById('menuToggle').addEventListener('click', function() {
                document.getElementById('adminNav').classList.toggle('active');
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Novo usuário
            document.getElementById('addUserBtn').addEventListener('click', openUserModal);
            
            // Formulário de usuário
            document.getElementById('userForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveUser();
            });
            
            // Upload de arquivos
            document.getElementById('fileInput').addEventListener('change', handleFileUpload);
            
            // Fechar modal com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
        }

        // ========== FUNÇÕES DO DASHBOARD ==========
        function updateStats() {
            document.getElementById('totalUsers').textContent = db.users.length;
            document.getElementById('totalFiles').textContent = db.files.length;
            document.getElementById('totalVideos').textContent = db.videos.length;
            document.getElementById('totalMaterials').textContent = db.materials.length;
        }

        function switchTab(tabId) {
            // Atualizar tabs ativas
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                }
            });
            
            // Mostrar conteúdo da tab
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}Tab`).classList.add('active');
            
            // Carregar dados da tab
            if (tabId === 'users') {
                loadUsersTable();
            } else if (tabId === 'files') {
                loadFilesTable();
            }
        }

        // ========== GERENCIAMENTO DE USUÁRIOS ==========
        function loadUsersTable() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            
            db.users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>
                        <strong>${user.name}</strong>
                        ${user.id === currentUser.id ? '<br><small class="status-badge status-active">Você</small>' : ''}
                    </td>
                    <td>${user.email}</td>
                    <td>
                        <span class="status-badge ${getUserTypeClass(user.type)}">
                            ${getUserTypeLabel(user.type)}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge ${user.status === 'active' ? 'status-active' : 'status-inactive'}">
                            ${user.status === 'active' ? 'Ativo' : 'Inativo'}
                        </span>
                    </td>
                    <td>${formatDate(user.createdAt)}</td>
                    <td class="table-actions">
                        <button class="btn btn-primary btn-sm" onclick="editUser(${user.id})" ${user.id === currentUser.id ? 'disabled' : ''}>
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})" ${user.id === currentUser.id ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function openUserModal(userId = null) {
            const modal = document.getElementById('userModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('userForm');
            
            if (userId) {
                // Modo edição
                editingUserId = userId;
                const user = db.users.find(u => u.id === userId);
                title.textContent = 'Editar Usuário';
                
                document.getElementById('modalUserName').value = user.name;
                document.getElementById('modalUserEmail').value = user.email;
                document.getElementById('modalUserType').value = user.type;
                document.getElementById('modalUserStatus').value = user.status;
                document.getElementById('modalUserPassword').required = false;
                document.getElementById('modalUserPassword').placeholder = 'Deixe em branco para manter';
            } else {
                // Modo criação
                editingUserId = null;
                title.textContent = 'Novo Usuário';
                form.reset();
                document.getElementById('modalUserPassword').required = true;
                document.getElementById('modalUserPassword').placeholder = '';
            }
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('userModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            editingUserId = null;
        }

        function saveUser() {
            const name = document.getElementById('modalUserName').value;
            const email = document.getElementById('modalUserEmail').value;
            const password = document.getElementById('modalUserPassword').value;
            const type = document.getElementById('modalUserType').value;
            const status = document.getElementById('modalUserStatus').value;
            
            // Validações
            if (!name || !email || !type || !status) {
                showToast('Preencha todos os campos obrigatórios', 'error');
                return;
            }
            
            if (!editingUserId && !password) {
                showToast('A senha é obrigatória para novos usuários', 'error');
                return;
            }
            
            // Verificar email único
            const emailExists = db.users.some(u => 
                u.email === email && u.id !== editingUserId
            );
            
            if (emailExists) {
                showToast('Este email já está em uso', 'error');
                return;
            }
            
            if (editingUserId) {
                // Atualizar usuário existente
                const userIndex = db.users.findIndex(u => u.id === editingUserId);
                if (userIndex !== -1) {
                    db.users[userIndex].name = name;
                    db.users[userIndex].email = email;
                    db.users[userIndex].type = type;
                    db.users[userIndex].status = status;
                    
                    // Atualizar senha apenas se fornecida
                    if (password) {
                        db.users[userIndex].password = password;
                    }
                    
                    showToast('Usuário atualizado com sucesso!');
                }
            } else {
                // Criar novo usuário
                const newUser = {
                    id: db.users.length > 0 ? Math.max(...db.users.map(u => u.id)) + 1 : 1,
                    name: name,
                    email: email,
                    password: password,
                    type: type,
                    status: status,
                    createdAt: new Date().toISOString()
                };
                
                db.users.push(newUser);
                showToast('Usuário criado com sucesso!');
            }
            
            saveDatabase();
            loadUsersTable();
            updateStats();
            closeModal();
        }

        function editUser(userId) {
            openUserModal(userId);
        }

        function deleteUser(userId) {
            if (confirm('Tem certeza que deseja excluir este usuário?\nEsta ação não pode ser desfeita.')) {
                db.users = db.users.filter(u => u.id !== userId);
                saveDatabase();
                loadUsersTable();
                updateStats();
                showToast('Usuário excluído com sucesso!');
            }
        }

        // ========== GERENCIAMENTO DE ARQUIVOS ==========
        function loadFilesTable() {
            const tbody = document.getElementById('filesTableBody');
            tbody.innerHTML = '';
            
            db.files.forEach(file => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <i class="fas fa-file ${getFileIconClass(file.type)}"></i>
                        <strong>${file.name}</strong>
                    </td>
                    <td>${file.type}</td>
                    <td>${file.size}</td>
                    <td>${file.uploadedAt}</td>
                    <td class="table-actions">
                        <button class="btn btn-primary btn-sm" onclick="downloadFile(${file.id})">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteFile(${file.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function handleFileUpload(e) {
            const files = Array.from(e.target.files);
            
            if (files.length === 0) return;
            
            files.forEach(file => {
                const newFile = {
                    id: db.files.length > 0 ? Math.max(...db.files.map(f => f.id)) + 1 : 1,
                    name: file.name,
                    type: getFileType(file.name),
                    size: formatFileSize(file.size),
                    uploadedAt: new Date().toLocaleDateString('pt-BR'),
                    uploadedBy: currentUser.name
                };
                
                db.files.push(newFile);
            });
            
            saveDatabase();
            loadFilesTable();
            updateStats();
            showToast(`${files.length} arquivo(s) adicionado(s)!`);
            
            // Limpar input
            e.target.value = '';
        }

        function downloadFile(fileId) {
            const file = db.files.find(f => f.id === fileId);
            if (file) {
                showToast(`Download iniciado: ${file.name}`);
                // Aqui você implementaria o download real
            }
        }

        function deleteFile(fileId) {
            if (confirm('Tem certeza que deseja excluir este arquivo?')) {
                db.files = db.files.filter(f => f.id !== fileId);
                saveDatabase();
                loadFilesTable();
                updateStats();
                showToast('Arquivo excluído com sucesso!');
            }
        }

        function refreshFiles() {
            loadFilesTable();
            showToast('Lista de arquivos atualizada!');
        }

        // ========== CONFIGURAÇÕES ==========
        function saveSettings() {
            db.settings.siteName = document.getElementById('siteName').value;
            db.settings.siteEmail = document.getElementById('siteEmail').value;
            db.settings.maintenanceMode = document.getElementById('maintenanceMode').value === 'true';
            
            saveDatabase();
            showToast('Configurações salvas com sucesso!');
        }

        function resetSettings() {
            if (confirm('Restaurar configurações padrão?')) {
                db.settings = {
                    siteName: "StudyCert",
                    siteEmail: "contato@studycert.com",
                    maintenanceMode: false
                };
                
                document.getElementById('siteName').value = db.settings.siteName;
                document.getElementById('siteEmail').value = db.settings.siteEmail;
                document.getElementById('maintenanceMode').value = db.settings.maintenanceMode.toString();
                
                saveDatabase();
                showToast('Configurações restauradas!');
            }
        }

        // ========== FUNÇÕES AUXILIARES ==========
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const messageEl = document.getElementById('toastMessage');
            
            toast.className = `toast ${type}`;
            messageEl.textContent = message;
            toast.style.display = 'flex';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        function getUserTypeLabel(type) {
            const types = {
                'student': 'Estudante',
                'instructor': 'Instrutor',
                'admin': 'Administrador'
            };
            return types[type] || type;
        }

        function getUserTypeClass(type) {
            const classes = {
                'student': 'status-active',
                'instructor': 'status-pending',
                'admin': 'status-badge badge-admin'
            };
            return classes[type] || '';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const types = {
                'pdf': 'PDF',
                'doc': 'Word',
                'docx': 'Word',
                'xls': 'Excel',
                'xlsx': 'Excel',
                'ppt': 'PowerPoint',
                'pptx': 'PowerPoint',
                'jpg': 'Imagem',
                'jpeg': 'Imagem',
                'png': 'Imagem',
                'mp4': 'Vídeo',
                'html': 'HTML',
                'css': 'CSS',
                'js': 'JavaScript'
            };
            return types[ext] || 'Arquivo';
        }

        function getFileIconClass(fileType) {
            const icons = {
                'PDF': 'fa-file-pdf',
                'Word': 'fa-file-word',
                'Excel': 'fa-file-excel',
                'PowerPoint': 'fa-file-powerpoint',
                'Imagem': 'fa-file-image',
                'Vídeo': 'fa-file-video',
                'HTML': 'fa-file-code',
                'CSS': 'fa-file-code',
                'JavaScript': 'fa-file-code'
            };
            return icons[fileType] || 'fa-file';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Fechar modal ao clicar fora
        document.getElementById('userModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
